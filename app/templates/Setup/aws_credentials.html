<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credenciales AWS - Configuración</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><i class="fas fa-cogs"></i> AWS Control</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home"></i> Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/configuracion"><i class="fas fa-cog"></i> Configuración</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/configuracion/aws-credentials"><i class="fab fa-aws"></i> Credenciales AWS</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <div class="card">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4><i class="fab fa-aws"></i> Configuración de Credenciales AWS</h4>
                        <a href="/configuracion" class="btn btn-light btn-sm"><i class="fas fa-arrow-left"></i> Volver</a>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Información de seguridad:</strong> Las credenciales se almacenan únicamente en la sesión del navegador y no se guardan permanentemente en el servidor.
                        </div>

                        <form method="POST" id="credentialsForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="aws_access_key_id" class="form-label">
                                            <i class="fas fa-key"></i> AWS Access Key ID <span class="text-danger">*</span>
                                        </label>
                                        <input type="text" class="form-control" id="aws_access_key_id" name="aws_access_key_id"
                                               value="{{ config.aws_access_key_id }}" required
                                               placeholder="AKIA...">
                                        <div class="form-text">Tu Access Key ID de AWS</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="aws_secret_access_key" class="form-label">
                                            <i class="fas fa-lock"></i> AWS Secret Access Key <span class="text-danger">*</span>
                                        </label>
                                        <input type="password" class="form-control" id="aws_secret_access_key" name="aws_secret_access_key"
                                               value="{{ config.aws_secret_access_key }}" required
                                               placeholder="Tu secret access key">
                                        <div class="form-text">Tu Secret Access Key de AWS</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="aws_session_token" class="form-label">
                                            <i class="fas fa-clock"></i> AWS Session Token <span class="text-muted">(Opcional)</span>
                                        </label>
                                        <input type="password" class="form-control" id="aws_session_token" name="aws_session_token"
                                               value="{{ config.aws_session_token }}"
                                               placeholder="Requerido para laboratorios AWS temporales">
                                        <div class="form-text">Solo necesario para credenciales temporales de laboratorio</div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="aws_default_region" class="form-label">
                                            <i class="fas fa-globe"></i> Región por Defecto
                                        </label>
                                        <select class="form-select" id="aws_default_region" name="aws_default_region">
                                            <option value="us-east-1" {% if config.aws_default_region == 'us-east-1' %}selected{% endif %}>US East (N. Virginia)</option>
                                            <option value="us-east-2" {% if config.aws_default_region == 'us-east-2' %}selected{% endif %}>US East (Ohio)</option>
                                            <option value="us-west-1" {% if config.aws_default_region == 'us-west-1' %}selected{% endif %}>US West (N. California)</option>
                                            <option value="us-west-2" {% if config.aws_default_region == 'us-west-2' %}selected{% endif %}>US West (Oregon)</option>
                                            <option value="eu-west-1" {% if config.aws_default_region == 'eu-west-1' %}selected{% endif %}>EU (Ireland)</option>
                                            <option value="eu-central-1" {% if config.aws_default_region == 'eu-central-1' %}selected{% endif %}>EU (Frankfurt)</option>
                                            <option value="ap-southeast-1" {% if config.aws_default_region == 'ap-southeast-1' %}selected{% endif %}>Asia Pacific (Singapore)</option>
                                            <option value="ap-northeast-1" {% if config.aws_default_region == 'ap-northeast-1' %}selected{% endif %}>Asia Pacific (Tokyo)</option>
                                            <option value="sa-east-1" {% if config.aws_default_region == 'sa-east-1' %}selected{% endif %}>South America (São Paulo)</option>
                                        </select>
                                        <div class="form-text">Región de AWS donde operar</div>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                        <a href="/configuracion/clear-credentials" class="btn btn-outline-warning me-md-2">
                                            <i class="fas fa-trash"></i> Limpiar Credenciales
                                        </a>
                                        <button type="submit" class="btn btn-primary">
                                            <i class="fas fa-save"></i> Guardar y Probar Conexión
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <hr>

                        <div class="row">
                            <div class="col-md-12">
                                <h5><i class="fas fa-question-circle"></i> ¿Cómo obtener tus credenciales AWS?</h5>
                                <div class="accordion" id="helpAccordion">
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
                                                <i class="fab fa-aws"></i> Credenciales de Usuario IAM
                                            </button>
                                        </h2>
                                        <div id="collapseOne" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                <ol>
                                                    <li>Ve a la <a href="https://console.aws.amazon.com/iam/" target="_blank">Consola de IAM</a></li>
                                                    <li>Selecciona "Users" en el menú lateral</li>
                                                    <li>Selecciona tu usuario o crea uno nuevo</li>
                                                    <li>Ve a la pestaña "Security credentials"</li>
                                                    <li>En "Access keys", haz clic en "Create access key"</li>
                                                    <li>Copia el Access Key ID y la Secret Access Key</li>
                                                </ol>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item">
                                        <h2 class="accordion-header">
                                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo">
                                                <i class="fas fa-flask"></i> Credenciales de Laboratorio AWS
                                            </button>
                                        </h2>
                                        <div id="collapseTwo" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                            <div class="accordion-body">
                                                <p>Para laboratorios temporales de AWS (como AWS Academy o eventos), necesitarás:</p>
                                                <ul>
                                                    <li><strong>Access Key ID</strong>: Proporcionado por el laboratorio</li>
                                                    <li><strong>Secret Access Key</strong>: Proporcionado por el laboratorio</li>
                                                    <li><strong>Session Token</strong>: <span class="text-danger">Requerido</span> para credenciales temporales</li>
                                                </ul>
                                                <p class="text-muted">Las credenciales de laboratorio suelen expirar después de unas horas.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Mostrar/ocultar secret key
        document.getElementById('toggleSecret').addEventListener('click', function() {
            const secretInput = document.getElementById('aws_secret_access_key');
            const icon = this.querySelector('i');

            if (secretInput.type === 'password') {
                secretInput.type = 'text';
                icon.className = 'fas fa-eye-slash';
            } else {
                secretInput.type = 'password';
                icon.className = 'fas fa-eye';
            }
        });

        // Validación del formulario
        document.getElementById('credentialsForm').addEventListener('submit', function(e) {
            const accessKey = document.getElementById('aws_access_key_id').value.trim();
            const secretKey = document.getElementById('aws_secret_access_key').value.trim();

            if (!accessKey || !secretKey) {
                e.preventDefault();
                alert('Access Key ID y Secret Access Key son campos requeridos.');
                return false;
            }

            if (!accessKey.startsWith('AKIA')) {
                e.preventDefault();
                alert('El Access Key ID debe comenzar con "AKIA".');
                return false;
            }
        });
    </script>
</body>
</html>