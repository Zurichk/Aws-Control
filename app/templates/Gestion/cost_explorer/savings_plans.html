&lt;!DOCTYPE html&gt;
&lt;html lang="es"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;Savings Plans - Cost Explorer&lt;/title&gt;
    &lt;link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"&gt;
    &lt;link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"&gt;
&lt;/head&gt;
&lt;body class="bg-light"&gt;
    &lt;div class="container-fluid py-4"&gt;
        &lt;div class="row"&gt;
            &lt;div class="col-12"&gt;
                &lt;nav aria-label="breadcrumb"&gt;
                    &lt;ol class="breadcrumb"&gt;
                        &lt;li class="breadcrumb-item"&gt;&lt;a href="{{ url_for('main.index') }}" class="text-decoration-none"&gt;Inicio&lt;/a&gt;&lt;/li&gt;
                        &lt;li class="breadcrumb-item"&gt;&lt;a href="{{ url_for('cost_explorer.cost_explorer_dashboard') }}" class="text-decoration-none"&gt;Cost Explorer&lt;/a&gt;&lt;/li&gt;
                        &lt;li class="breadcrumb-item active" aria-current="page"&gt;Savings Plans&lt;/li&gt;
                    &lt;/ol&gt;
                &lt;/nav&gt;

                &lt;div class="d-flex justify-content-between align-items-center mb-4"&gt;
                    &lt;h1 class="h3 mb-0"&gt;&lt;i class="fas fa-piggy-bank text-primary me-2"&gt;&lt;/i&gt;Savings Plans&lt;/h1&gt;
                    &lt;a href="{{ url_for('cost_explorer.cost_explorer_dashboard') }}" class="btn btn-outline-secondary"&gt;
                        &lt;i class="fas fa-arrow-left me-2"&gt;&lt;/i&gt;Volver
                    &lt;/a&gt;
                &lt;/div&gt;

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            &lt;div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert"&gt;
                                {{ message }}
                                &lt;button type="button" class="btn-close" data-bs-dismiss="alert"&gt;&lt;/button&gt;
                            &lt;/div&gt;
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                &lt;div class="card shadow-sm"&gt;
                    &lt;div class="card-header bg-primary text-white"&gt;
                        &lt;h5 class="card-title mb-0"&gt;&lt;i class="fas fa-search me-2"&gt;&lt;/i&gt;Utilización de Savings Plans&lt;/h5&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;form method="POST" class="row g-3"&gt;
                            &lt;div class="col-md-5"&gt;
                                &lt;label for="start_date" class="form-label"&gt;&lt;i class="fas fa-calendar-start me-1"&gt;&lt;/i&gt;Fecha Inicio *&lt;/label&gt;
                                &lt;input type="date" class="form-control" id="start_date" name="start_date"
                                       value="{{ start_date }}" required&gt;
                                &lt;div class="form-text"&gt;Fecha de inicio del período de análisis&lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-5"&gt;
                                &lt;label for="end_date" class="form-label"&gt;&lt;i class="fas fa-calendar-end me-1"&gt;&lt;/i&gt;Fecha Fin *&lt;/label&gt;
                                &lt;input type="date" class="form-control" id="end_date" name="end_date"
                                       value="{{ end_date }}" required&gt;
                                &lt;div class="form-text"&gt;Fecha de fin del período de análisis&lt;/div&gt;
                            &lt;/div&gt;
                            &lt;div class="col-md-2 d-flex align-items-end"&gt;
                                &lt;button type="submit" class="btn btn-primary w-100"&gt;
                                    &lt;i class="fas fa-search me-2"&gt;&lt;/i&gt;Analizar
                                &lt;/button&gt;
                            &lt;/div&gt;
                        &lt;/form&gt;
                    &lt;/div&gt;
                &lt;/div&gt;

                {% if savings_plans %}
                &lt;div class="card shadow-sm mt-4"&gt;
                    &lt;div class="card-header bg-success text-white d-flex justify-content-between align-items-center"&gt;
                        &lt;h5 class="card-title mb-0"&gt;&lt;i class="fas fa-chart-bar me-2"&gt;&lt;/i&gt;Utilización de Savings Plans&lt;/h5&gt;
                        &lt;span class="badge bg-light text-dark"&gt;{{ savings_plans|length }} métricas&lt;/span&gt;
                    &lt;/div&gt;
                    &lt;div class="card-body"&gt;
                        &lt;div class="table-responsive"&gt;
                            &lt;table class="table table-striped table-hover"&gt;
                                &lt;thead class="table-dark"&gt;
                                    &lt;tr&gt;
                                        &lt;th&gt;&lt;i class="fas fa-calendar me-1"&gt;&lt;/i&gt;Período&lt;/th&gt;
                                        &lt;th&gt;&lt;i class="fas fa-percentage me-1"&gt;&lt;/i&gt;Utilización&lt;/th&gt;
                                        &lt;th&gt;&lt;i class="fas fa-dollar-sign me-1"&gt;&lt;/i&gt;Cobertura&lt;/th&gt;
                                        &lt;th&gt;&lt;i class="fas fa-coins me-1"&gt;&lt;/i&gt;Moneda&lt;/th&gt;
                                    &lt;/tr&gt;
                                &lt;/thead&gt;
                                &lt;tbody&gt;
                                    {% for plan in savings_plans %}
                                    {% set utilization_pct = plan.utilization_percentage|float %}
                                    {% set coverage_pct = plan.coverage_percentage|float %}
                                    &lt;tr&gt;
                                        &lt;td&gt;&lt;strong&gt;{{ plan.period }}&lt;/strong&gt;&lt;/td&gt;
                                        &lt;td&gt;
                                            &lt;div class="d-flex align-items-center"&gt;
                                                &lt;span class="badge me-2
                                                    {% if utilization_pct >= 90 %}bg-success
                                                    {% elif utilization_pct >= 70 %}bg-warning
                                                    {% else %}bg-danger{% endif %}"&gt;
                                                    {{ "%.1f"|format(utilization_pct) }}%
                                                &lt;/span&gt;
                                                &lt;div class="progress flex-grow-1" style="height: 8px;"&gt;
                                                    &lt;div class="progress-bar
                                                        {% if utilization_pct >= 90 %}bg-success
                                                        {% elif utilization_pct >= 70 %}bg-warning
                                                        {% else %}bg-danger{% endif %}"
                                                         role="progressbar"
                                                         style="width: {{ utilization_pct }}%"
                                                         aria-valuenow="{{ utilization_pct }}"
                                                         aria-valuemin="0" aria-valuemax="100"&gt;&lt;/div&gt;
                                                &lt;/div&gt;
                                            &lt;/div&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;
                                            &lt;div class="d-flex align-items-center"&gt;
                                                &lt;span class="badge bg-info me-2"&gt;{{ "%.1f"|format(coverage_pct) }}%&lt;/span&gt;
                                                &lt;div class="progress flex-grow-1" style="height: 8px;"&gt;
                                                    &lt;div class="progress-bar bg-info" role="progressbar"
                                                         style="width: {{ coverage_pct }}%"
                                                         aria-valuenow="{{ coverage_pct }}"
                                                         aria-valuemin="0" aria-valuemax="100"&gt;&lt;/div&gt;
                                                &lt;/div&gt;
                                            &lt;/div&gt;
                                        &lt;/td&gt;
                                        &lt;td&gt;&lt;code&gt;{{ plan.unit }}&lt;/code&gt;&lt;/td&gt;
                                    &lt;/tr&gt;
                                    {% endfor %}
                                &lt;/tbody&gt;
                            &lt;/table&gt;
                        &lt;/div&gt;

                        {% if savings_plans %}
                        &lt;div class="mt-4"&gt;
                            {% set avg_utilization = savings_plans|sum(attribute='utilization_percentage')|float / savings_plans|length %}
                            {% set avg_coverage = savings_plans|sum(attribute='coverage_percentage')|float / savings_plans|length %}

                            &lt;div class="row"&gt;
                                &lt;div class="col-md-4"&gt;
                                    &lt;div class="card text-center border-primary"&gt;
                                        &lt;div class="card-body"&gt;
                                            &lt;h5 class="card-title text-primary"&gt;{{ "%.1f"|format(avg_utilization) }}%&lt;/h5&gt;
                                            &lt;p class="card-text small"&gt;Utilización Promedio&lt;/p&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                                &lt;div class="col-md-4"&gt;
                                    &lt;div class="card text-center border-info"&gt;
                                        &lt;div class="card-body"&gt;
                                            &lt;h5 class="card-title text-info"&gt;{{ "%.1f"|format(avg_coverage) }}%&lt;/h5&gt;
                                            &lt;p class="card-text small"&gt;Cobertura Promedio&lt;/p&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                                &lt;div class="col-md-4"&gt;
                                    &lt;div class="card text-center border-success"&gt;
                                        &lt;div class="card-body"&gt;
                                            &lt;h5 class="card-title text-success"&gt;{{ savings_plans|length }}&lt;/h5&gt;
                                            &lt;p class="card-text small"&gt;Períodos Analizados&lt;/p&gt;
                                        &lt;/div&gt;
                                    &lt;/div&gt;
                                &lt;/div&gt;
                            &lt;/div&gt;

                            &lt;div class="alert alert-info mt-4" role="alert"&gt;
                                &lt;h6&gt;&lt;i class="fas fa-info-circle me-2"&gt;&lt;/i&gt;Interpretación de Resultados&lt;/h6&gt;
                                &lt;ul class="mb-0"&gt;
                                    &lt;li&gt;&lt;strong&gt;Utilización ≥ 90%&lt;/strong&gt;: Excelente uso de Savings Plans&lt;/li&gt;
                                    &lt;li&gt;&lt;strong&gt;Utilización 70-89%&lt;/strong&gt;: Buen uso, pero puede optimizarse&lt;/li&gt;
                                    &lt;li&gt;&lt;strong&gt;Utilización &lt; 70%&lt;/strong&gt;: Bajo uso, considerar ajustes en los planes&lt;/li&gt;
                                    &lt;li&gt;&lt;strong&gt;Cobertura&lt;/strong&gt;: Porcentaje de costos cubiertos por Savings Plans&lt;/li&gt;
                                &lt;/ul&gt;
                            &lt;/div&gt;
                        &lt;/div&gt;
                        {% endif %}
                    &lt;/div&gt;
                &lt;/div&gt;
                {% endif %}
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;

    &lt;script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;